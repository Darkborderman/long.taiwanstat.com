
<!doctype html>

<html>

<head>
  <title> D3 </title>
  <link href="c3.css" rel="stylesheet" type="text/css">
  <script src = "http://d3js.org/d3.v3.min.js"></script>
  <script src="c3.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>



  <style>
    svg{
      width: 2000px;
    }

    g{
      pointer-events: painted;
      
    }

    /*#em_line{
      opacity:1;
    }*/

    /*.c3-shapes{
      opacity:0.3;
    }*/

    /*#em_line{
      opacity:1;
    }*/

    #select_line{
      font-size: 30px;
    }
    #top{
      z-index: 1000;
    }


    select{
      font-size: 30px;
    }


  </style>

</head>

<body>

  <div id = "spline_chart"></div>
  <div class = "line_info">
    <h1>INFO
      <span id = "gender"></span>
      <span id = "county"></span>
      <span id = "cancer"></span>
      <!-- <br> -->
      <span id = "oldest_happen_rate"></span>
      <span id = "newest_happen_rate"></span>
    </h1>
  </div>



  <div id = "graphSettings">
    <div id = 'blue'>
      <form>
        <select id="sex_form">
    　     <option selected = "selected">不分男女</option>
    　     <option>男</option>
    　     <option>女</option>
        </select>
      </form>    
 

      <form>
        <select id="county_form">
    　     <option selected = "selected">全國</option>
    　     <option>台北市</option>
    　     <option>台中市</option>
           <option>台南市</option>
           <option>高雄市</option>
           <option>基隆市</option>
           <option>新竹市</option>
           <option>嘉義市</option>
           <option>新北市</option>
           <option>桃園市</option>
           <option>新竹縣</option>
           <option>宜蘭縣</option>
           <option>苗栗縣</option>
           <option>彰化縣</option>
           <option>南投縣</option>
           <option>雲林縣</option>
           <option>嘉義縣</option>
           <option>屏東縣</option>
           <option>澎湖縣</option>
           <option>花蓮縣</option>
           <option>台東縣</option>
           <option>金門縣</option>
           <option>連江縣</option>
        </select>
      </form>    



    </div>
  </div>

  <script type="text/javascript">
    d3.csv("cancer_happen_rate.csv", analyze_happen_rate);

    function analyze_happen_rate(data){

      //get [ [yaer][sex][cancer][county] [happen rate every year]]

      var categories = ['性別', '縣市', '癌別'];

      var category_combinations = [];     //stores all category combinations
      
      //get all cancer type for form
      var cancer_type = [];
      for(i = 0; i < data.length; i++){
        if( cancer_type.indexOf(data[i]['癌別']) <0){
          cancer_type.push(data[i]['癌別'])
        }

      }

      d3.select('#blue')
        .append('form')
        .append('select')
        .attr('id', 'cancer_form')
        .selectAll('option')
        .data(cancer_type)
        .enter()
        .append('option')
        .text( function(d){
          return d;
        })




      for(i = 0; i< 100; i++){         //change data length here
        
        if(data[i]['年度'] == '1996'){
          var category_combination = [];
          for( j = 0; j < categories.length; j++){
            // console.log(categories[j]);
            if(data[i].hasOwnProperty(categories[j])){
              category_combination.push(data[i][categories[j]]);
            }
          }
        category_combinations.push(category_combination);       

        }
      }

      for(j = 0; j < category_combinations.length; j++){
        for(i = 0; i < data.length; i++){
          if(data[i]['性別'] ==category_combinations[j][0] && data[i]['縣市'] ==category_combinations[j][1] && data[i]['癌別'] ==category_combinations[j][2]){
              category_combinations[j].push(+data[i]['WHO2000年人口標準化發生率(每10萬人口)']);
          }
        }
      }

      // console.log(category_combinations);

      //merge first 3 elements
      var category_combinations_merged = category_combinations;

      for(i = 0; i < category_combinations_merged.length; i++){
        var categories_string = category_combinations_merged[i].splice(0, 3).join();

        category_combinations_merged[i].unshift(categories_string);
      }

      console.log(category_combinations_merged);  //total 2211 arrays

      // debugger;

      var year_ticks = ['year_ticks'];

      for (var i = 1996; i <= 2030; i++) {
         year_ticks.push(i);
      }

      category_combinations_merged.unshift(year_ticks);

      var chart = c3.generate({
        bindto: '#spline_chart',
        data: {
            x: 'year_ticks',
            columns: category_combinations_merged,

            type: 'spline',
        },
        axis: {
            x: {
                label:{
                    text: '西元年',
                    position: 'outer-middle'
                },
                tick:{
                    culling:{
                        max:24,
                    },
                },
            }
        },
        size:{
          height: 500,
          width:1000
        },
        legend: {
          show: false
        },
        zoom: {
            enabled: false
        },
        point: {
            show: false
        },
        color: {
            pattern:  ['#1f77b4'],  
        },
        onresize: function () {},

        onresized: function () {},
        tooltip: {
            show: false
        },


        
      });


      d3.select('.c3-line-不分男女-全國-口腔')   //initail red line
          .style('stroke-width', '100px')
          

      d3.select('.c3-line-不分男女-全國-口腔')   //initail red line
          .style('stroke', 'red')

      // d3.selectAll('selected_line')
      //   .data('.c3-line-不分男女-全國-口腔')
      //   .enter()
      //   .append('path')
      //   .style('stroke', 'red')


      d3.select('svg')
        .select('.c3-chart-lines')
        .selectAll('.c3-chart-line')
        .select('.c3-shapes.c3-lines')
        .select("path")
        .style('stroke-width', '2.5px')

        .on("mouseover", function(d){
            // console.log(d);

            d3.select('.c3-chart-lines').selectAll("path").sort(function (a, b) { // select the parent and sort the path's
              if (a.id != d.id) return -1;               // a is not the hovered element, send "a" to the back
              else return 1;                             // a is the hovered element, bring "a" to the front
            });

            d3.select(this)
              .style('stroke', 'red')
              .style('stroke-width', '8px');

            d3.select('#gender').html(d.id.split(',')[0]);
            d3.select('#county').html(d.id.split(',')[1]);
            d3.select('#cancer').html(d.id.split(',')[2]);
            d3.select('#oldest_happen_rate').html('1996: ' + d.values[0].value);

            var newest_year = 1993 + d.values.length+2;
            d3.select('#newest_happen_rate').html( newest_year + ": " +d.values[d.values.length-1].value);
        })

        .on("mouseleave", function(){
            d3.select(this)
              .style('stroke', '#1f77b4')
              .style('stroke-width', '2.5px');

            d3.select('#gender').html(null);
            d3.select('#county').html(null);
            d3.select('#cancer').html(null);
            d3.select('#oldest_happen_rate').html(null);
            d3.select('#newest_happen_rate').html(null);

        });



       // document.getElementById("select_line").click(); 
      // console.log($('input[name=b_sex]:checked').val())
         

      d3.select('#blue').on('change', function(){

        d3.select('svg')
            .select('.c3-chart-lines')
            .selectAll('.c3-chart-line')
            .select('.c3-shapes.c3-lines')
            .select("path")
            .style('stroke', '#1f77b4')

        var sex_input = document.getElementById("sex_form");
        var selected_sex = sex_input.options[sex_input.selectedIndex].text;

        var county_input = document.getElementById("county_form");
        var selected_county = county_input.options[county_input.selectedIndex].text;


        var cancer_input = document.getElementById("cancer_form");
        var selected_cancer = cancer_input.options[cancer_input.selectedIndex].text;

        combined_input = '.c3-line-' + selected_sex + "-"+ selected_county + "-" +selected_cancer;
        console.log(combined_input);

         d3.select(combined_input)
          .style('stroke', 'red')

      });



      // debugger;

      // d3.select('#select_line')
      //   .on('click', function(){

      //     console.log('button clicked');

      //     chart.load({
      //       colors: {
      //         '不分男女,台北市,口腔': 'red',

      //       },
      //     });
      //   });





    
    }




  </script>


</body>

</html>



