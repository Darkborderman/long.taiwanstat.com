<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">

<html>

  <head>
    <title>台灣物價指數變化</title>
    <meta charset="utf-8" />
    <link href="css/semantic.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/index.css" rel="stylesheet" type="text/css"/>
    <meta property="og:title" content="台灣物價指數變化">
    <meta property="og:site_name" content="台灣物價指數變化">
    <meta property="og:description" content="台灣物價指數變化">
    <meta property="og:image" content="http://i.imgur.com/zIXU42K.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="300">
    <meta property="og:image:height" content="300">
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:400,700" rel="stylesheet" type="text/css">
  </head>

  <body>

    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/semantic.min.js" type="text/javascript"></script> 
    <script src="js/d3.min.js" type="text/javascript"></script> 
    <script src="js/d3-tip.js"></script>
    <script src="js/visual.js" type="text/javascript"></script> 

    <div class="ui basic main segment">
      <div class="ui head basic segment">
        <h1 class="ui header">台灣物價指數變化</h1>
      </div>

      <nav id="menu" class="navigation">
        <ul>
          <li><a href="http://water.taiwanstat.com/">台灣水庫即時水情</a></li>
        </ul>
        <ul>
          <li><a href="http://real.taiwanstat.com/air/">台灣即時空氣品質指標</a></li>
        </ul>
      </nav>

      <div class="ui stackable two column grid">
        <div class="column">
          <div class="fb-like-box" data-href="https://www.facebook.com/statTaiwan?fref=ts" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="false" data-show-border="false"></div>
        </div>
        <div class="column">
          <div class="fb-like" data-href="http://long.taiwanstat.com/price/" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
        </div>
      </div>

      <div class="ui head basic segment">
        <h2 class="ui header">時間</h2>
      </div>
      <div class="control panels">
        <div class="year control panel">
          <div class="ui compact icon year control left button">
            <i class="year caret left icon"></i>
          </div>
          <div class="ui tiny year control teal progress">
            <div class="bar"></div>
            <div class="year label"></div>
          </div>
          <div class="ui compact icon year left control button">
            <i class="year caret right icon"></i>
          </div>
        </div>

        <div class="month control panel">
          <div class="ui compact icon month control left button">
            <i class="month caret left icon"></i>
          </div>
          <div class="ui tiny month control teal progress">
            <div class="bar"></div>
            <div class="month label"></div>
          </div>
          <div class="ui compact icon month control right button">
            <i class="month caret right icon"></i>
          </div>
        </div>
      </div>

      <br>

      <div class="ui stackable two column grid">
        <div class="column">
          <table class="ui stackable  celled striped table">
            <thead>
              <tr><th colspan="2">
                較去年同月漲幅前五類別
              </th>
            </tr></thead><tbody>
              <tr>
                <td class="left aligned upType1 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal red statistic">
                    <div class="upType1 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="upType2 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal red statistic">
                    <div class="upType2 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="upType3 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal red statistic">
                    <div class="upType3 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="upType4 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal red statistic">
                    <div class="upType4 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="upType5 name"></td>
                <td class="right aligned"><div class="ui small horizontal red statistic">
                    <div class="upType5 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="column">
          <table class="ui stackable  celled striped table">
            <thead>
              <tr><th colspan="2">
                較去年同月跌幅前五類別
              </th>
            </tr></thead><tbody>
              <tr>
                <td class="left aligned downType1 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal green statistic">
                    <div class="downType1 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="downType2 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal green statistic">
                    <div class="downType2 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="downType3 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal green statistic">
                    <div class="downType3 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="downType4 name"></td>
                <td class="right aligned">
                  <div class="ui small horizontal green statistic">
                    <div class="downType4 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="downType5 name"></td>
                <td class="right aligned"><div class="ui small horizontal green statistic">
                    <div class="downType5 value"></div>
                    <div class="label">
                      %
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <br>
      <div class="ui segment">
        <div class="ui head basic segment">
          <h2 class="ui header">各類別數值與漲跌關係圖</h2>
          <div class="ui switch checkbox">
            <input type="checkbox" checked="checked">
            <label>簡易版</label>
          </div>
        </div>
        <div class="plot"></div>
        <div class="ui basic intro segment">
          *紅色方格: 一起漲、綠色方格:一起跌 <br>
          *建議以電腦版瀏覽
        </div>
      </div>

    </div>

    <script charset="utf-8">

      d3.json('data/summary.json', function(data){

        var simple = data.simple;
        var complicated = data.complicated;

        data = simple;
        var switchFlag = true;
        $('.ui.checkbox')
          .checkbox({onChange: function(){

            $('.plot').html("");
            if(switchFlag){
              switchFlag = false;
              data = complicated;
            }
            else {
              switchFlag = true;
              data = simple;
            }
            plot(data, year.toString(), month);
          }});
        ;

        var years = Object.keys(data);

        var year = parseInt(years[years.length-1]);
        var month = parseInt(Object.keys(data[year]).length);

        plot(data, year.toString(), month);
        updateTable(complicated, year.toString(), month);

        var yearPercent = d3.scale.linear()
          .domain([parseInt(years[0]), year])
          .range([13, 100]);

        var monthPercent = d3.scale.linear()
          .domain([1, 12])
          .range([13, 100]);


        $('.year.progress').progress({percent: yearPercent(year), autoSuccess:false});
        $('.month.progress').progress({percent: monthPercent(month), autoSuccess:false});

        $('.year.label').text(year + '年');
        $('.month.label').text(month + '月');

        $('.year.caret.left').on('click', function(){
          if(year-1 >= parseInt(years[0]))
            year = year-1;
          $('.year.label').text(year + '年');
          $('.year.progress').progress({percent: yearPercent(year), autoSuccess:false});

          updatePlot(data, year.toString(), month);
          updateTable(complicated, year.toString(), month);
        })

        $('.year.caret.right').on('click', function(){
          if(year+1 <= parseInt(years[years.length-1]))
            year = year+1;

          if(year == parseInt(years[years.length-1]) && month > parseInt(Object.keys(data[year]).length)){
            month = parseInt(Object.keys(data[year]).length);
            $('.month.label').text(month+ '月');
            $('.month.progress').progress({percent: monthPercent(month), autoSuccess:false});
          }
          $('.year.label').text(year+ '年');
          $('.year.progress').progress({percent: yearPercent(year), autoSuccess:false});
          updatePlot(data, year.toString(), month);
          updateTable(complicated, year.toString(), month);
        })

        $('.month.caret.left').on('click', function(){
          if(month-1 >= 1)
            month = month-1;
          else if(year > parseInt(years[0])){
            month = 12;
            year = year - 1;
            $('.year.label').text(year+ '年');
            $('.year.progress').progress({percent: yearPercent(year), autoSuccess:false});
          }

          $('.month.label').text(month + '月');
          $('.month.progress').progress({percent: monthPercent(month), autoSuccess:false});
          updatePlot(data, year.toString(), month);
          updateTable(complicated, year.toString(), month);
        })

        $('.month.caret.right').on('click', function(){
          if(year == parseInt(years[years.length-1]) && month < parseInt(Object.keys(data[year]).length))
            month = month + 1;
          else if(year != parseInt(years[years.length-1]) && month+1 <= 12)
            month = month+1;
          else if(month==12 && year<parseInt(years[years.length-1])){
            month = 1;
            year = year +1;
            $('.year.label').text(year+ '年');
            $('.year.progress').progress({percent: yearPercent(year), autoSuccess:false});
          }
          $('.month.label').text(month+ '月');
          $('.month.progress').progress({percent: monthPercent(month), autoSuccess:false});
          updatePlot(data, year.toString(), month);
          updateTable(complicated, year.toString(), month);
        })

      })

    </script>
		<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61023469-1', 'auto');
      ga('send', 'pageview');
    </script>
    <div id="fb-root"></div>
    <script>
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&appId=600079286760117&version=v2.0";
        fjs.parentNode.insertBefore(js, fjs);
      }
      (document, 'script', 'facebook-jssdk'));
    </script>
  </body>

</html>
