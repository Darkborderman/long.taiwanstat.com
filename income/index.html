<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html"; charset="utf-8">
  <meta property="og:title" content="用數據看台灣">
  <meta property="og:site_name" content="用數據看台灣">
  <meta property="og:description" content="用數據看台灣">
  <meta property="og:image" content="http://i.imgur.com/04AFcnA.png">
  <meta property="og:image:type" content="image/jpg">
  <meta property="og:image:width" content="300">
  <meta property="og:image:height" content="300">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/bower_components/semantic/dist/semantic.min.css" type="text/css" media="all" />
  <link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" href="/favicon.ico" />

  <link rel="stylesheet" href="css/index.css" type="text/css" media="all" />
  <link rel="stylesheet" href="css/visual.css" type="text/css" media="all" />

  <title>台灣富人所得統計(1977-2013)</title>
</head>
<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/headroom/0.7.0/headroom.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="/js/main.js"></script>
  <script src="/bower_components/semantic/dist/semantic.min.js"></script>

  <div class="ui basic main segment">
    <div class="ui head basic segment">
      <h1 class="ui header">台灣富人所得統計(1977-2013)</h1>
    </div>

    <div class="ui head basic segment">
      <h1 class="ui header">時間</h1>
    </div>

    <div class="control panels">
      <div class="year control panel">
        <div class="ui compact icon year control left button">
          <i class="year caret left icon"></i>
        </div>

        <div class="ui horizontal year control statistic">
          <div class="value"></div>
          <div class="label">年</div>
        </div>

        <div class="ui compact icon year right control button">
          <i class="year caret right icon"></i>
        </div>
      </div>
    </div>

    <div class="ui yearDetail basic segment">

      <div class="ui stackable grid">
        <div class="ten wide column">
          <div class="plot"></div>
        </div>

        <div class="six wide column">
          <h1 class="ui focus header"></h1>

          <div class="ui focus small statistics">

            <h3 class="ui attribute header">總年收入值</h3>
            <div class="ui horizontal statistic">
              <div class="raw value"></div>
              <div class="label">
                萬元(新臺幣)
              </div>
            </div><br><br><br>

            <h3 class="ui attribute header">每人平均年收入</h3>
            <div class="ui horizontal statistic">
              <div class="mean value"></div>
              <div class="label">
                萬元(新臺幣)
              </div>
            </div><br><br><br>

            <h3 class="ui attribute header">所得佔全部比例</h3>
            <div class="ui horizontal statistic">
              <div class="percent value"></div>
              <div class="label">
                %
              </div>
            </div><br><br><br>

            <h3 class="ui attribute header">子項目</h3>
            <table class="ui table">
              <thead>
                <tr>
                  <th>項目</th>
                  <th>每人平均年收入</th>
                  <th>所得佔全部比例</th>
                </tr>
              </thead>
              <tbody class="tbody">
              </tbody>
            </table>

            <br>
            <div class="note">
              <ul>
                <li class="data-src">資料來源：<a href="http://topincomes.parisschoolofeconomics.eu/">WTID</a></li>
                <li>圖中圓形大小代表各族群所得佔總所得的比例。</li>
                <li>點擊圖中圓形可以對其放大，並顯示其資料。</li>
                <li>WTID提供之資料為1977至2013。</li>
              </ul>
            </div>

          </div>

        </div>

    </div>


  </div>

  <script src="js/visual.js"></script>
  <script>

    var raw = null;

    var curYearIndex = 0;
    var year = 0;
    var years = [];

    var curData = {};


    d3.csv("data/data.csv", function(data) {

      raw = data;

      for(var i=0; i<data.length; i++)
        years.push(data[i].Year);

      curYearIndex = years.length-1;

      buttonInit();
      var d = getDataOfYear(years[curYearIndex]);
      curData = d.data;
      plot(d.plotForm);

    })

    function buttonInit() {

      year = years[curYearIndex];
      $('.year.control .value').html('<i class="small calendar outline icon"></i>' + year);

      $('.year.left.button').on('click', function(){
        if(curYearIndex == 0)
          curYearIndex = years.length-1;
        else
          curYearIndex = curYearIndex - 1;
        $('.year.control .value').html('<i class="small calendar outline icon"></i>' + years[curYearIndex])
        // updateTable();
        var d = getDataOfYear(years[curYearIndex]);
        curData = d.data;
        updatePlot(d.plotForm);
      })
      $('.year.right.button').on('click', function(){
        if(curYearIndex == years.length-1)
          curYearIndex = 0;
        else
          curYearIndex = curYearIndex + 1;
        $('.year.control .value').html('<i class="small calendar outline icon"></i>' + years[curYearIndex])
        // updateTable();
        var d = getDataOfYear(years[curYearIndex]);
        curData = d.data;
        updatePlot(d.plotForm);
      })

    }

    function getDataOfYear(year) {
      var data = {};
      var result = {};

      for(var k in raw) {
        if(raw[k].Year == year)
          data = raw[k];
      }

      result.data = data;
      result.plotForm = {
        'name': '全部',
        'id': 'all',
        'children': [
          {
            'name': '前10%',
            'id': 'top10',
            'children': [
              {
                'name': '前5-10%',
                'id': 'top105',
                'size': parseFloat(data['Top 10-5% income share'])/4
              },
              {
                'name': '前5%',
                'id': 'top5',
                'children':[
                  {
                    'name': '前1-5%',
                    'id': 'top51',
                    'size': parseFloat(data['Top 5-1% income share'])/4
                  },
                  {
                    'name': '前1%',
                    'id': 'top1',
                    'children': [
                      {
                        'name': '前0.1-1%',
                        'id': 'top011',
                        'size': (parseFloat(data['Top 1% income share']) - parseFloat(data['Top 0.1-0.01% income share']) -  parseFloat(data['Top 0.01% income share']))/4
                      },
                      {
                        'name': '前0.01-0.1%',
                        'id': 'top0101',
                        'size': parseFloat(data['Top 0.1-0.01% income share'])
                      },
                      {
                        'name': '前0.01%',
                        'id': 'top001',
                        'size': parseFloat(data['Top 0.01% income share'])
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            'name': '後90%',
            'id': 'bot90',
            'size': (100 - parseFloat(data['Top 10% income share']))/2
          }
        ]
      }

      return result;

    }

  </script>

</body>
